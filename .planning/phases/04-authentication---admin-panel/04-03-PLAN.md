---
phase: 04-authentication---admin-panel
plan: 03
type: execute
wave: 2
depends_on: [04-01]
files_modified:
  - app/admin/layout.tsx
  - app/admin/page.tsx
autonomous: false

must_haves:
  truths:
    - "Unauthenticated users cannot access /admin routes (redirected to sign-in)"
    - "Admin layout shows user email and sign-out link"
    - "Admin sidebar navigation links to Projects, Resume, Changelog sections"
    - "Admin dashboard shows welcome message and stats"
  artifacts:
    - path: "app/admin/layout.tsx"
      provides: "Admin shell with auth check, sidebar, user info"
      min_lines: 80
    - path: "app/admin/page.tsx"
      provides: "Admin dashboard overview"
      min_lines: 40
  key_links:
    - from: "app/admin/layout.tsx"
      to: "@workos-inc/authkit-nextjs"
      via: "withAuth() server function"
      pattern: "withAuth\\(\\)"
    - from: "app/admin/layout.tsx"
      to: "/auth/sign-out"
      via: "Sign-out link in header"
      pattern: "/auth/sign-out"
    - from: "app/admin/page.tsx"
      to: "convex/react"
      via: "useQuery hooks for stats"
      pattern: "useQuery"
---

<objective>
Create admin layout shell with authentication verification, sidebar navigation, and dashboard overview page.

Purpose: Establish protected admin area with consistent layout and navigation. Provides second layer of auth defense (after middleware) with user-friendly redirect to sign-in.

Output: Working admin area at /admin with sidebar navigation, user info display, and dashboard showing portfolio stats.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/04-authentication---admin-panel/04-RESEARCH.md

# Auth foundation
@.planning/phases/04-authentication---admin-panel/04-01-PLAN.md

# Current layout patterns
@app/layout.tsx
@components/navigation/Header.tsx
</context>

<tasks>

<task type="auto">
  <name>Create admin layout with auth check and navigation</name>
  <files>app/admin/layout.tsx</files>
  <action>
    Create app/admin/layout.tsx:

    1. Import withAuth from @workos-inc/authkit-nextjs and redirect from next/navigation
    2. Import Link from next/link

    3. Create async AdminLayout Server Component:
       - Call: const { user } = await withAuth();
       - If !user: redirect('/auth/sign-in')
       - Render admin shell structure:
         * Dark bg-gray-950 min-h-screen
         * Top nav bar (bg-gray-900, border-b border-gray-800):
           - Left: "Admin Panel" heading
           - Right: User email (text-gray-400) + Sign Out link (/auth/sign-out, text-red-400)
         * Main container (flex gap-8, container mx-auto px-4 py-8):
           - Aside sidebar (w-64 shrink-0):
             * Dashboard link (/admin)
             * Projects link (/admin/projects)
             * Resume link (/admin/resume)
             * Changelog link (/admin/changelog)
             * Contact Submissions link (/admin/contact)
             * Each link: block px-4 py-2 rounded bg-gray-800 hover:bg-gray-700
           - Main content area (flex-1): {children}

    4. Style follows dark minimalist aesthetic matching public site

    Reference: 04-RESEARCH.md "Admin Layout with Auth Check" for structure.
    Pattern: Server Component with withAuth() check at layout level (second defense layer after middleware).
  </action>
  <verify>
    1. Check app/admin/layout.tsx exists and is async Server Component
    2. Check withAuth() is called and redirects if no user
    3. Check sidebar has 5 navigation links (Dashboard, Projects, Resume, Changelog, Contact)
    4. Check header shows user email and sign-out link
    5. Run: npm run typecheck
  </verify>
  <done>
    Admin layout provides protected shell with auth verification, sidebar navigation, and user info display.
  </done>
</task>

<task type="auto">
  <name>Create admin dashboard page</name>
  <files>app/admin/page.tsx</files>
  <action>
    Create app/admin/page.tsx:

    1. Mark as 'use client' (needs Convex hooks for stats)
    2. Import useQuery from convex/react and api from @/convex/_generated/api
    3. Import Link from next/link

    4. Create AdminDashboard component:
       - Use useQuery to fetch stats:
         * Projects count: api.projects.listAll (length)
         * Published count: filter listAll by status === "published"
         * Featured count: filter listAll by featured === true
         * Contact submissions: api.contactSubmissions.listAll (length)
         * New submissions: filter by status === "new"

       - Render dashboard:
         * Heading: "Dashboard" (text-3xl font-bold mb-8)
         * Welcome message: "Welcome to your portfolio admin panel"
         * Stats grid (grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6):
           - Projects card: Total projects, published count
           - Featured card: Featured projects count
           - Contact card: Total submissions, new count
         * Each card: bg-gray-800 p-6 rounded-lg
         * Quick links section:
           - "Create New Project" -> /admin/projects/new
           - "Edit Resume" -> /admin/resume
           - "View Contact Submissions" -> /admin/contact

    5. Handle loading state with skeleton or "Loading..." message
    6. Dark theme styling consistent with admin layout

    Pattern: Client Component using Convex reactive queries for real-time stats.
  </action>
  <verify>
    1. Check app/admin/page.tsx exists and is Client Component
    2. Check useQuery hooks for projects and contactSubmissions
    3. Check stats cards render counts
    4. Check quick links to other admin sections
    5. Run: npm run build
  </verify>
  <done>
    Admin dashboard shows portfolio stats (projects, submissions) and quick links to admin sections.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Admin layout with authentication verification, sidebar navigation, and dashboard overview with stats.
  </what-built>
  <how-to-verify>
    Test admin area:

    1. Ensure you're signed in (from Plan 01 verification)
    2. Visit http://localhost:3000/admin
    3. Verify admin layout renders:
       - Top nav shows "Admin Panel" + your email + "Sign Out" link
       - Sidebar shows 5 navigation links (Dashboard, Projects, Resume, Changelog, Contact)
       - Dashboard content shows welcome message
    4. Check dashboard stats:
       - Projects count (should match database)
       - Contact submissions count
       - Stats update if you have existing data
    5. Test navigation:
       - Click sidebar links (may show 404 for Projects/Resume/Changelog/Contact - expected, built in next plans)
       - Click "Sign Out" link - should clear session and redirect to home
    6. Test auth protection:
       - After sign-out, try visiting /admin directly
       - Should redirect to WorkOS sign-in page
    7. Test responsive design:
       - Resize browser window
       - Sidebar should remain visible and usable on desktop
       - Layout should adapt on mobile

    Expected behavior:
    - Only authenticated users can access /admin
    - Layout shows user email and sign-out link
    - Dashboard displays stats from Convex queries
    - Navigation links are present (even if destinations not built yet)

    If issues:
    - Check browser console for errors
    - Verify WorkOS session cookie exists
    - Check Convex backend is running (npx convex dev)
  </how-to-verify>
  <resume-signal>Type "approved" if admin layout works, or describe issues</resume-signal>
</task>

</tasks>

<verification>
1. /admin redirects to sign-in when not authenticated
2. Authenticated user sees admin layout with sidebar
3. Dashboard shows stats from Convex queries
4. User email displayed in header
5. Sign-out link clears session
6. All navigation links present in sidebar
</verification>

<success_criteria>
- ADMIN-01: Admin dashboard layout with navigation to Projects, Resume, Changelog sections âœ“
- Dashboard shows portfolio overview stats
- Auth check at layout level (second defense layer)
- Dark minimalist aesthetic consistent with public site
</success_criteria>

<output>
After completion, create `.planning/phases/04-authentication---admin-panel/04-03-SUMMARY.md` documenting:
- Admin layout created with auth verification and sidebar navigation
- Dashboard page showing portfolio stats
- Navigation links to admin sections (Projects, Resume, Changelog, Contact)
- User email display and sign-out functionality
- Verification results from human testing
</output>
