---
phase: 04-authentication---admin-panel
plan: 05
type: execute
wave: 3
depends_on: [04-02, 04-03]
files_modified:
  - app/admin/resume/page.tsx
  - app/admin/resume/schema.ts
  - app/admin/resume/actions.ts
  - app/admin/resume/ResumeForm.tsx
  - app/admin/changelog/page.tsx
  - components/admin/ChangelogVisibilityToggle.tsx
  - app/admin/contact/page.tsx
  - components/admin/ContactSubmissionCard.tsx
autonomous: false

must_haves:
  truths:
    - "Admin can edit resume data (highlights, experience, education, skills)"
    - "Admin can view all changelog entries"
    - "Admin can toggle changelog entry visibility"
    - "Admin can view all contact form submissions"
    - "Admin can mark contact submissions as archived"
  artifacts:
    - path: "app/admin/resume/page.tsx"
      provides: "Resume editor page"
      min_lines: 30
    - path: "app/admin/resume/ResumeForm.tsx"
      provides: "Resume form with nested arrays"
      min_lines: 250
    - path: "app/admin/resume/schema.ts"
      provides: "Zod schema for resume validation"
      exports: ["resumeSchema", "ResumeFormData"]
    - path: "app/admin/resume/actions.ts"
      provides: "Server Action for updating resume"
      exports: ["updateResumeAction"]
    - path: "app/admin/changelog/page.tsx"
      provides: "Changelog list with visibility toggles"
      min_lines: 60
    - path: "components/admin/ChangelogVisibilityToggle.tsx"
      provides: "Visibility toggle component"
      min_lines: 40
    - path: "app/admin/contact/page.tsx"
      provides: "Contact submissions list"
      min_lines: 80
    - path: "components/admin/ContactSubmissionCard.tsx"
      provides: "Contact submission display card"
      min_lines: 50
  key_links:
    - from: "app/admin/resume/ResumeForm.tsx"
      to: "react-hook-form"
      via: "useFieldArray for nested arrays"
      pattern: "useFieldArray"
    - from: "app/admin/changelog/page.tsx"
      to: "convex/changelog.ts"
      via: "useQuery(api.changelog.listAll)"
      pattern: "useQuery.*api\\.changelog\\.listAll"
    - from: "app/admin/contact/page.tsx"
      to: "convex/contactSubmissions.ts"
      via: "useQuery(api.contactSubmissions.listAll)"
      pattern: "useQuery.*api\\.contactSubmissions\\.listAll"
---

<objective>
Build admin interfaces for resume editing, changelog visibility management, and contact submission review.

Purpose: Complete the admin panel with remaining content management tools. Resume editor handles complex nested arrays, changelog shows automated entries with visibility toggles, contact submissions provide inbox-like review interface.

Output: Three admin sections (Resume, Changelog, Contact) with appropriate CRUD/toggle operations for each content type.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/04-authentication---admin-panel/04-RESEARCH.md

# Dependencies
@.planning/phases/04-authentication---admin-panel/04-02-PLAN.md
@.planning/phases/04-authentication---admin-panel/04-03-PLAN.md
@.planning/phases/04-authentication---admin-panel/04-04-PLAN.md

# Schema and patterns
@convex/schema.ts
@convex/resume.ts
@convex/changelog.ts
@convex/contactSubmissions.ts
@app/admin/projects/new/ProjectForm.tsx
</context>

<tasks>

<task type="auto">
  <name>Create resume editor schema, action, and form</name>
  <files>app/admin/resume/schema.ts, app/admin/resume/actions.ts, app/admin/resume/ResumeForm.tsx, app/admin/resume/page.tsx</files>
  <action>
    1. Create app/admin/resume/schema.ts:
       - Import z from zod
       - Export resumeSchema matching convex/schema.ts resume table:
         * highlights: z.array(z.string().min(1))
         * experience: z.array(z.object({
             role: z.string().min(1),
             company: z.string().min(1),
             period: z.string().min(1),
             description: z.string().min(1),
             achievements: z.array(z.string().min(1))
           }))
         * education: z.array(z.object({
             degree: z.string().min(1),
             institution: z.string().min(1),
             year: z.string().min(1)
           }))
         * skills: z.array(z.object({
             category: z.string().min(1),
             items: z.array(z.string().min(1))
           }))
       - Export type ResumeFormData = z.infer<typeof resumeSchema>

    2. Create app/admin/resume/actions.ts:
       - Mark 'use server'
       - Import resumeSchema, ResumeFormData
       - Import api, fetchMutation, withAuth
       - Export async updateResumeAction(formData: ResumeFormData):
         * Verify auth with withAuth()
         * Validate with resumeSchema.parse(formData)
         * Call fetchMutation(api.resume.update, validated)
         * Return { success: true }

    3. Create app/admin/resume/ResumeForm.tsx:
       - Mark 'use client'
       - Import useForm, useFieldArray from react-hook-form
       - Import zodResolver from @hookform/resolvers/zod
       - Import resumeSchema, ResumeFormData from ./schema
       - Import updateResumeAction from ./actions
       - Accept initialData prop (optional, for pre-population)
       - Create ResumeForm component:
         * Initialize form with useForm + zodResolver + defaultValues (initialData or empty arrays)
         * Use useFieldArray for: highlights, experience, education, skills
         * Render sections:
           - Highlights (dynamic array of text inputs)
           - Experience (nested arrays: role, company, period, description, achievements)
           - Education (dynamic array with degree, institution, year)
           - Skills (nested arrays: category, items)
         * Each section has Add/Remove buttons
         * Submit button calls updateResumeAction
         * Show validation errors
         * Toast on success

    4. Create app/admin/resume/page.tsx:
       - Mark 'use client'
       - Import useQuery from convex/react, api
       - Import ResumeForm component
       - Fetch resume: const resume = useQuery(api.resume.get)
       - Handle loading state
       - Render heading "Edit Resume" and ResumeForm with initialData={resume || undefined}

    Reference: 04-RESEARCH.md form patterns and projects admin structure.
    Pattern: Complex form with nested arrays using useFieldArray.
  </action>
  <verify>
    1. Check app/admin/resume/schema.ts exports resumeSchema with nested structure
    2. Check app/admin/resume/actions.ts exports updateResumeAction
    3. Check app/admin/resume/ResumeForm.tsx uses multiple useFieldArray hooks
    4. Check app/admin/resume/page.tsx fetches and passes resume data
    5. Run: npm run typecheck
  </verify>
  <done>
    Resume editor with complex nested form structure (highlights, experience, education, skills).
  </done>
</task>

<task type="auto">
  <name>Create changelog admin page with visibility toggles</name>
  <files>app/admin/changelog/page.tsx, components/admin/ChangelogVisibilityToggle.tsx</files>
  <action>
    1. Create components/admin/ChangelogVisibilityToggle.tsx:
       - Mark 'use client'
       - Import useMutation from convex/react, api, useState, toast
       - Accept props: entryId, initialVisible
       - Use useState for optimisticVisible (initialized with initialVisible)
       - Use useMutation for api.changelog.updateVisibility
       - On toggle:
         * Update optimisticVisible immediately
         * Call mutation with new visible value
         * Show toast on success
         * Rollback optimisticVisible on error
       - Render toggle button or checkbox showing current visibility state

    2. Create app/admin/changelog/page.tsx:
       - Mark 'use client'
       - Import useQuery from convex/react, api
       - Import ChangelogVisibilityToggle component
       - Fetch changelog: const entries = useQuery(api.changelog.listAll)
       - Handle loading state
       - Render:
         * Heading "Changelog"
         * Helper text: "Changelog entries are auto-generated on PR merge (post-v1). Toggle visibility to show/hide on public pages."
         * Entries list or table:
           - Each entry shows: date, title, summary, type badge, PR number (if exists), visibility toggle
           - Sort by date descending (newest first)
         * Empty state if no entries

    Pattern: Read-only list with visibility toggles (entries created by automation, not manually).
  </action>
  <verify>
    1. Check components/admin/ChangelogVisibilityToggle.tsx exists with optimistic updates
    2. Check app/admin/changelog/page.tsx fetches and displays changelog entries
    3. Check entries sorted by date (newest first)
    4. Check visibility toggle integrated into list
    5. Run: npm run build
  </verify>
  <done>
    Changelog admin page with visibility toggles for controlling which entries appear on public pages.
  </done>
</task>

<task type="auto">
  <name>Create contact submissions admin page</name>
  <files>app/admin/contact/page.tsx, components/admin/ContactSubmissionCard.tsx</files>
  <action>
    1. Create components/admin/ContactSubmissionCard.tsx:
       - Mark 'use client'
       - Import useMutation from convex/react, api, toast
       - Accept props: submission (id, name, email, message, status, submittedAt)
       - Use useMutation for api.contactSubmissions.updateStatus
       - Render card:
         * Name and email (bold name, gray email)
         * Message (truncated with "Read more" if long)
         * Submitted date (formatted from submittedAt)
         * Status badge (new = blue, archived = gray)
         * Actions:
           - Email link (mailto:email)
           - Archive button (if status=new, calls mutation to set status=archived)
           - Unarchive button (if status=archived, calls mutation to set status=new)
         * Dark card styling consistent with admin UI

    2. Create app/admin/contact/page.tsx:
       - Mark 'use client'
       - Import useQuery from convex/react, api
       - Import ContactSubmissionCard component
       - Fetch submissions: const submissions = useQuery(api.contactSubmissions.listAll)
       - Handle loading state
       - Render:
         * Heading "Contact Submissions"
         * Filter tabs: "All" | "New" | "Archived" (client-side filter)
         * Submissions list (grid or stack):
           - Each submission as ContactSubmissionCard
           - Sort by submittedAt descending (newest first)
         * Empty state if no submissions

    Pattern: Inbox-like interface with filtering and status management.
  </action>
  <verify>
    1. Check components/admin/ContactSubmissionCard.tsx renders submission details
    2. Check card has Archive/Unarchive actions
    3. Check app/admin/contact/page.tsx fetches and displays submissions
    4. Check filtering by status works
    5. Check mailto link for emailing submitter
    6. Run: npm run typecheck
  </verify>
  <done>
    Contact submissions admin page with filtering, status management, and email links.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Admin interfaces for resume editing, changelog visibility management, and contact submission review.
  </what-built>
  <how-to-verify>
    Test resume, changelog, and contact admin sections:

    **Resume Editor:**
    1. Visit http://localhost:3000/admin/resume
    2. If no resume data exists, form should be empty
    3. Test adding data:
       - Add highlight: "10+ years experience"
       - Add experience entry:
         * Role: "Senior Engineer"
         * Company: "Tech Corp"
         * Period: "2020-2024"
         * Description: "Led team"
         * Achievements: "Shipped feature X", "Improved perf 50%"
       - Add education: "BS Computer Science, University, 2015"
       - Add skill category: "Frontend", items: "React, Next.js, TypeScript"
    4. Submit form
    5. Verify toast success message
    6. Refresh page - data should persist
    7. Test validation: try submitting with empty required fields

    **Changelog Admin:**
    1. Visit http://localhost:3000/admin/changelog
    2. If no changelog entries, should show empty state (entries created by automation in post-v1)
    3. If entries exist (or manually create test entry via Convex dashboard):
       - Verify entry displays: date, title, summary, type, PR number
       - Click visibility toggle
       - Verify toggle updates immediately (optimistic)
       - Verify change persists on refresh

    **Contact Submissions:**
    1. Visit http://localhost:3000/admin/contact
    2. If no submissions, test by submitting contact form on public site
    3. Verify submission appears in admin list
    4. Test filtering:
       - Click "New" tab - should show only new submissions
       - Click "Archived" tab - should show only archived
       - Click "All" tab - should show all
    5. Test actions:
       - Click "Archive" on new submission - status changes to archived
       - Verify submission moves to archived filter
       - Click email link - should open mailto with submitter's email
       - Click "Unarchive" - submission returns to new

    Expected behavior:
    - Resume form saves complex nested data
    - Changelog shows entries with visibility toggles
    - Contact submissions show inbox-like interface
    - All toggles update optimistically
    - All changes persist to Convex

    If issues:
    - Check browser console for errors
    - Verify Convex backend running
    - Check mutations authenticate properly
  </how-to-verify>
  <resume-signal>Type "approved" if all admin sections work, or describe issues</resume-signal>
</task>

</tasks>

<verification>
1. Resume editor saves complex nested data (highlights, experience, education, skills)
2. Changelog list displays entries with visibility toggles
3. Contact submissions list shows inbox interface with filtering
4. All toggles work with optimistic UI updates
5. All changes persist to Convex database
6. Forms validate input and show errors
</verification>

<success_criteria>
- ADMIN-08: Resume editor for highlights, experience, education, skills sections ✓
- ADMIN-09: Changelog list showing all entries ✓
- ADMIN-10: Toggle visibility for changelog entries ✓
- Contact submissions admin (not in original requirements but completing admin panel):
  - View all contact form submissions
  - Filter by status (new/archived)
  - Archive/unarchive submissions
  - Email links for contacting submitters
</success_criteria>

<output>
After completion, create `.planning/phases/04-authentication---admin-panel/04-05-SUMMARY.md` documenting:
- Resume editor with nested array forms
- Changelog admin with visibility toggles
- Contact submissions inbox interface
- Filtering and status management for contact submissions
- Verification results from human testing
- Notes on UX and data management
</output>
