---
phase: 02-public-content-pages
plan: 04
type: execute
wave: 2
depends_on: [02-01]
files_modified:
  - app/projects/page.tsx
  - app/projects/[slug]/page.tsx
  - app/projects/[slug]/not-found.tsx
  - components/projects/ProjectGrid.tsx
  - components/projects/ProjectCard.tsx
autonomous: false

must_haves:
  truths:
    - "Visitor can browse all published projects on /projects page"
    - "Visitor can click through to individual project detail pages"
    - "Project detail shows problem, approach, constraints, impact, stack, links"
    - "Draft projects never appear on public pages"
    - "Invalid project slugs show 404 page"
    - "Project cards have scroll reveal animations"
  artifacts:
    - path: "app/projects/page.tsx"
      provides: "Projects index with Server Component data fetching"
      min_lines: 20
    - path: "app/projects/[slug]/page.tsx"
      provides: "Dynamic project detail page with SEO metadata"
      min_lines: 60
    - path: "components/projects/ProjectGrid.tsx"
      provides: "Client Component for reactive project grid"
      exports: ["ProjectGrid"]
    - path: "components/projects/ProjectCard.tsx"
      provides: "Animated project card (reusable)"
      exports: ["ProjectCard"]
  key_links:
    - from: "app/projects/page.tsx"
      to: "convex/projects.ts"
      via: "preloadQuery"
      pattern: "preloadQuery.*api\\.projects\\.listPublished"
    - from: "app/projects/[slug]/page.tsx"
      to: "convex/projects.ts"
      via: "preloadQuery for page, fetchQuery for metadata"
      pattern: "preloadQuery.*api\\.projects\\.getBySlug"
    - from: "components/projects/ProjectCard.tsx"
      to: "framer-motion"
      via: "motion component"
      pattern: "motion\\."
---

<objective>
Build projects index and detail pages with dynamic routing, SEO metadata, and animations.

Purpose: Projects showcase is core portfolio content. Index page lists all published projects. Detail pages show full project information with problem/approach/impact structure. Both use Convex queries with proper filtering.

Output: Complete projects section with index, detail pages, 404 handling, and animated cards. Uses Next.js dynamic routes with generateStaticParams for build-time rendering.
</objective>

<execution_context>
@D:\Projects\saad-portfolio\.claude\get-shit-done\workflows\execute-plan.md
@D:\Projects\saad-portfolio\.claude\get-shit-done\templates\summary.md
</execution_context>

<context>
@D:\Projects\saad-portfolio\.planning\PROJECT.md
@D:\Projects\saad-portfolio\.planning\REQUIREMENTS.md
@D:\Projects\saad-portfolio\.planning\phases\02-public-content-pages\02-RESEARCH.md
@D:\Projects\saad-portfolio\convex\schema.ts
@D:\Projects\saad-portfolio\convex\projects.ts
@D:\Projects\saad-portfolio\app\layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build projects index page with grid layout</name>
  <files>
    app/projects/page.tsx
    components/projects/ProjectGrid.tsx
    components/projects/ProjectCard.tsx
  </files>
  <action>
Create projects index page with Server Component data fetching and reusable grid/card components.

File: `app/projects/page.tsx` (replace placeholder)
```typescript
import { Suspense } from "react";
import { preloadQuery } from "convex/nextjs";
import { api } from "@/convex/_generated/api";
import { ProjectGrid } from "@/components/projects/ProjectGrid";

export const metadata = {
  title: "Projects | Saad Shaikh",
  description: "Portfolio of web applications, automation workflows, and engineering projects",
};

export default async function ProjectsPage() {
  const preloadedProjects = await preloadQuery(api.projects.listPublished);

  return (
    <div className="space-y-12 pb-16">
      <section>
        <h1 className="text-4xl font-bold mb-4 text-gray-50">Projects</h1>
        <p className="text-gray-400 text-lg max-w-2xl">
          A selection of web applications, automation workflows, and engineering projects
          demonstrating full-stack development, AI-assisted workflows, and modern web technologies.
        </p>
      </section>

      <Suspense
        fallback={
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {[1, 2, 3].map((i) => (
              <div
                key={i}
                className="h-80 bg-gray-900 rounded-lg animate-pulse border border-gray-800"
              />
            ))}
          </div>
        }
      >
        <ProjectGrid preloadedProjects={preloadedProjects} />
      </Suspense>
    </div>
  );
}
```

File: `components/projects/ProjectGrid.tsx` (new file)
```typescript
"use client";
import { usePreloadedQuery } from "convex/react";
import { Preloaded } from "convex/react";
import { api } from "@/convex/_generated/api";
import { ProjectCard } from "./ProjectCard";

type Props = {
  preloadedProjects: Preloaded<typeof api.projects.listPublished>;
};

export function ProjectGrid({ preloadedProjects }: Props) {
  const projects = usePreloadedQuery(preloadedProjects);

  if (projects.length === 0) {
    return (
      <div className="bg-gray-900 rounded-lg p-12 text-center border border-gray-800">
        <p className="text-gray-400 text-lg">
          No projects yet. Check back soon!
        </p>
      </div>
    );
  }

  return (
    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {projects.map((project) => (
        <ProjectCard key={project._id} project={project} />
      ))}
    </div>
  );
}
```

File: `components/projects/ProjectCard.tsx` (new file - REUSABLE from home page)
```typescript
"use client";
import { motion } from "framer-motion";
import Link from "next/link";
import { Id } from "@/convex/_generated/dataModel";

type Project = {
  _id: Id<"projects">;
  title: string;
  slug: string;
  summary: string;
  stack: string[];
  tags: string[];
};

type Props = {
  project: Project;
};

export function ProjectCard({ project }: Props) {
  return (
    <motion.article
      initial={{ opacity: 0, y: 20 }}
      whileInView={{ opacity: 1, y: 0 }}
      viewport={{ once: true, margin: "-100px" }}
      transition={{ duration: 0.5, ease: "easeOut" }}
    >
      <Link href={`/projects/${project.slug}`}>
        <motion.div
          whileHover={{ scale: 1.02, y: -4 }}
          whileTap={{ scale: 0.98 }}
          className="bg-gray-900 rounded-lg p-6 border border-gray-800
                     hover:border-gray-700 transition-colors h-full flex flex-col"
        >
          <h3 className="text-xl font-bold mb-2 text-gray-50">{project.title}</h3>
          <p className="text-gray-400 mb-4 line-clamp-3 flex-grow">{project.summary}</p>

          <div className="flex flex-wrap gap-2 mb-4">
            {project.stack.slice(0, 4).map((tech) => (
              <span
                key={tech}
                className="px-2 py-1 bg-gray-800 rounded text-sm text-gray-300"
              >
                {tech}
              </span>
            ))}
            {project.stack.length > 4 && (
              <span className="px-2 py-1 bg-gray-800 rounded text-sm text-gray-500">
                +{project.stack.length - 4}
              </span>
            )}
          </div>

          <div className="flex flex-wrap gap-2">
            {project.tags.map((tag) => (
              <span key={tag} className="text-xs text-gray-600">
                #{tag}
              </span>
            ))}
          </div>
        </motion.div>
      </Link>
    </motion.article>
  );
}
```

RESEARCH PATTERN: Server Component with preloadQuery for reactive project list. Client Components for grid and animated cards.

NOTE: ProjectCard is REUSABLE - also used by home page FeaturedProjects. Home page should import from components/projects/ProjectCard.tsx after this task completes (manual fix or leave for later cleanup).
  </action>
  <verify>
Visit http://localhost:3000/projects in browser.
Verify empty state message shows (expected - no projects in Convex yet).
Run `npm run typecheck` to verify no TypeScript errors.
Verify Suspense fallback shows skeleton cards during loading.
  </verify>
  <done>
Projects index page complete with Server Component, Client Component grid, reusable ProjectCard, and empty state handling.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build dynamic project detail page with SEO</name>
  <files>
    app/projects/[slug]/page.tsx
    app/projects/[slug]/not-found.tsx
  </files>
  <action>
Create dynamic route for project detail pages with generateMetadata, generateStaticParams, and 404 handling.

File: `app/projects/[slug]/page.tsx` (replace placeholder if exists, or create)
```typescript
import { fetchQuery, preloadQuery } from "convex/nextjs";
import { api } from "@/convex/_generated/api";
import { notFound } from "next/navigation";
import Link from "next/link";

type Props = {
  params: Promise<{ slug: string }>;
};

// Generate static params for build-time rendering
export async function generateStaticParams() {
  const projects = await fetchQuery(api.projects.listPublished);
  return projects.map((project) => ({
    slug: project.slug,
  }));
}

// Generate SEO metadata per project
export async function generateMetadata({ params }: Props) {
  const { slug } = await params;
  const project = await fetchQuery(api.projects.getBySlug, { slug });

  if (!project) {
    return {
      title: "Project Not Found",
    };
  }

  return {
    title: `${project.title} | Projects`,
    description: project.summary,
    openGraph: {
      title: project.title,
      description: project.summary,
      type: "article",
    },
  };
}

export default async function ProjectDetailPage({ params }: Props) {
  const { slug } = await params;
  const project = await fetchQuery(api.projects.getBySlug, { slug });

  // Handle 404 for invalid slugs
  if (!project) {
    notFound();
  }

  // Parse content sections (assuming content has problem/approach/impact/constraints structure)
  const sections = parseProjectContent(project.content);

  return (
    <article className="max-w-4xl mx-auto space-y-12 pb-16">
      {/* Header */}
      <header>
        <Link
          href="/projects"
          className="text-gray-500 hover:text-gray-400 transition-colors mb-4 inline-block"
        >
          ← Back to Projects
        </Link>
        <h1 className="text-4xl font-bold mb-4 text-gray-50">{project.title}</h1>
        <p className="text-xl text-gray-400">{project.summary}</p>
      </header>

      {/* Stack */}
      <section>
        <h2 className="text-2xl font-bold mb-4 text-gray-50">Tech Stack</h2>
        <div className="flex flex-wrap gap-3">
          {project.stack.map((tech) => (
            <span
              key={tech}
              className="px-4 py-2 bg-gray-900 border border-gray-800 rounded text-gray-300"
            >
              {tech}
            </span>
          ))}
        </div>
      </section>

      {/* Content Sections */}
      {sections.problem && (
        <section>
          <h2 className="text-2xl font-bold mb-4 text-gray-50">Problem</h2>
          <div className="prose prose-invert max-w-none text-gray-300 leading-relaxed">
            {sections.problem}
          </div>
        </section>
      )}

      {sections.approach && (
        <section>
          <h2 className="text-2xl font-bold mb-4 text-gray-50">Approach</h2>
          <div className="prose prose-invert max-w-none text-gray-300 leading-relaxed">
            {sections.approach}
          </div>
        </section>
      )}

      {sections.constraints && (
        <section>
          <h2 className="text-2xl font-bold mb-4 text-gray-50">Constraints</h2>
          <div className="prose prose-invert max-w-none text-gray-300 leading-relaxed">
            {sections.constraints}
          </div>
        </section>
      )}

      {sections.impact && (
        <section>
          <h2 className="text-2xl font-bold mb-4 text-gray-50">Impact</h2>
          <div className="prose prose-invert max-w-none text-gray-300 leading-relaxed">
            {sections.impact}
          </div>
        </section>
      )}

      {/* Fallback if content doesn't have structured sections */}
      {!sections.problem && !sections.approach && project.content && (
        <section>
          <h2 className="text-2xl font-bold mb-4 text-gray-50">Details</h2>
          <div className="prose prose-invert max-w-none text-gray-300 leading-relaxed whitespace-pre-wrap">
            {project.content}
          </div>
        </section>
      )}

      {/* Links */}
      {project.links.length > 0 && (
        <section>
          <h2 className="text-2xl font-bold mb-4 text-gray-50">Links</h2>
          <div className="flex flex-wrap gap-4">
            {project.links.map((link) => (
              <a
                key={link.url}
                href={link.url}
                target="_blank"
                rel="noopener noreferrer"
                className="px-6 py-3 bg-gray-900 border border-gray-800
                           hover:border-gray-700 rounded text-gray-300
                           hover:text-gray-50 transition-colors"
              >
                {link.label} →
              </a>
            ))}
          </div>
        </section>
      )}

      {/* Tags */}
      {project.tags.length > 0 && (
        <section>
          <div className="flex flex-wrap gap-2">
            {project.tags.map((tag) => (
              <span key={tag} className="text-sm text-gray-600">
                #{tag}
              </span>
            ))}
          </div>
        </section>
      )}
    </article>
  );
}

// Helper function to parse content into sections
// Assumes content is plain text with section markers like "## Problem", "## Approach", etc.
function parseProjectContent(content: string) {
  const sections: Record<string, string> = {};

  const problemMatch = content.match(/##\s*Problem\s*\n([\s\S]*?)(?=##|$)/i);
  const approachMatch = content.match(/##\s*Approach\s*\n([\s\S]*?)(?=##|$)/i);
  const constraintsMatch = content.match(/##\s*Constraints\s*\n([\s\S]*?)(?=##|$)/i);
  const impactMatch = content.match(/##\s*Impact\s*\n([\s\S]*?)(?=##|$)/i);

  if (problemMatch) sections.problem = problemMatch[1].trim();
  if (approachMatch) sections.approach = approachMatch[1].trim();
  if (constraintsMatch) sections.constraints = constraintsMatch[1].trim();
  if (impactMatch) sections.impact = impactMatch[1].trim();

  return sections;
}
```

File: `app/projects/[slug]/not-found.tsx` (new file)
```typescript
import Link from "next/link";

export default function ProjectNotFound() {
  return (
    <div className="max-w-2xl mx-auto py-24 text-center">
      <h1 className="text-4xl font-bold mb-4 text-gray-50">Project Not Found</h1>
      <p className="text-gray-400 text-lg mb-8">
        The project you're looking for doesn't exist or has been removed.
      </p>
      <Link
        href="/projects"
        className="inline-block px-6 py-3 bg-gray-900 border border-gray-800
                   hover:border-gray-700 rounded text-gray-300 transition-colors"
      >
        ← Back to Projects
      </Link>
    </div>
  );
}
```

RESEARCH PATTERNS:
- generateStaticParams for build-time rendering of known project routes
- generateMetadata for per-project SEO and OpenGraph tags
- fetchQuery in metadata (not preloadQuery - metadata runs separately)
- notFound() for 404 handling with proper HTTP status
- await params per Next.js 15 requirement

CONTENT STRUCTURE:
- Assumes project.content has markdown-style sections (## Problem, ## Approach, etc.)
- parseProjectContent helper extracts sections with regex
- Fallback to full content if no sections found
- Whitespace-pre-wrap preserves line breaks

NAVIGATION:
- Back to Projects link at top
- External links open in new tab with noopener/noreferrer
  </action>
  <verify>
Visit http://localhost:3000/projects/invalid-slug in browser.
Verify 404 page renders with "Project Not Found" message.
Run `npm run typecheck` to verify no TypeScript errors.
Check that generateStaticParams, generateMetadata, and notFound are used correctly.
  </verify>
  <done>
Project detail page complete with dynamic routing, SEO metadata, 404 handling, and structured content rendering.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete projects section with:
1. Projects index page at /projects with grid layout
2. Dynamic project detail pages at /projects/[slug]
3. 404 handling for invalid project slugs
4. Animated project cards with scroll reveals
5. SEO metadata for each project
  </what-built>
  <how-to-verify>
1. Visit http://localhost:3000/projects
   - Verify empty state message (expected - no projects in Convex yet)
   - Verify dark theme styling

2. Visit http://localhost:3000/projects/invalid-slug
   - Verify custom 404 page renders
   - Verify "Back to Projects" link works

3. Test responsive layout
   - Resize to mobile (375px) - verify 1 column grid
   - Resize to desktop (1440px) - verify 3 column grid

4. Check console for errors (none expected)

5. Run build check: `npm run build`
   - Verify build completes without errors
   - Check build output shows projects routes as dynamic (λ) since no static params yet

EXPECTED STATE: Projects pages render correctly with empty state. 404 handling works. Build completes successfully. Projects will populate when data is added via admin panel.
  </how-to-verify>
  <resume-signal>
Type "approved" to continue, or describe any issues to address.
  </resume-signal>
</task>

</tasks>

<verification>
Visit http://localhost:3000/projects and verify:
- Empty state message (expected)
- Dark theme styling
- Responsive grid layout

Visit http://localhost:3000/projects/invalid-slug and verify:
- Custom 404 page
- Back to Projects link

Run `npm run build` and verify:
- Build completes without errors
- Projects routes appear in build output

No console errors.
</verification>

<success_criteria>
1. Projects index page fetches data from Convex using preloadQuery
2. ProjectGrid and ProjectCard components created with animations
3. Dynamic [slug] route implemented with generateStaticParams
4. generateMetadata creates per-project SEO tags
5. notFound() function handles invalid slugs with custom 404 page
6. Project detail page parses and renders structured content
7. Responsive grid layout (1/2/3 columns)
8. Dark theme styling consistent across pages
9. Build completes successfully
10. No TypeScript or runtime errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-public-content-pages/02-04-SUMMARY.md` documenting:
- Projects index and detail pages implementation
- Dynamic routing with generateStaticParams pattern
- SEO metadata approach
- Content parsing logic
- Human verification results
- Build output analysis
</output>
