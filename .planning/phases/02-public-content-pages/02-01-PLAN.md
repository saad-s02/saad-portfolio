---
phase: 02-public-content-pages
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - convex/projects.ts
  - convex/resume.ts
autonomous: true

must_haves:
  truths:
    - "Convex queries return published projects efficiently using indexes"
    - "Featured projects query returns exactly top 3 published featured projects"
    - "Project detail query finds project by slug"
    - "Resume query returns structured data for display"
  artifacts:
    - path: "convex/projects.ts"
      provides: "Project query functions"
      exports: ["listPublished", "listFeatured", "getBySlug"]
    - path: "convex/resume.ts"
      provides: "Resume query function"
      exports: ["get"]
    - path: "package.json"
      contains: "framer-motion"
  key_links:
    - from: "convex/projects.ts"
      to: "convex/schema.ts"
      via: "withIndex references"
      pattern: "withIndex\\(\"by_status\""
    - from: "convex/projects.ts"
      to: "convex/schema.ts"
      via: "withIndex references"
      pattern: "withIndex\\(\"by_featured\""
---

<objective>
Create Convex query functions and install Framer Motion to enable data fetching and animations for all public pages.

Purpose: Provides the data layer foundation that all Phase 2 pages will use. Query functions use indexes for efficient filtering of published vs draft projects and featured projects.

Output: Working Convex query API with listPublished, listFeatured, getBySlug for projects and get for resume. Framer Motion installed and ready for page animations.
</objective>

<execution_context>
@D:\Projects\saad-portfolio\.claude\get-shit-done\workflows\execute-plan.md
@D:\Projects\saad-portfolio\.claude\get-shit-done\templates\summary.md
</execution_context>

<context>
@D:\Projects\saad-portfolio\.planning\PROJECT.md
@D:\Projects\saad-portfolio\.planning\ROADMAP.md
@D:\Projects\saad-portfolio\.planning\STATE.md
@D:\Projects\saad-portfolio\.planning\phases\02-public-content-pages\02-RESEARCH.md
@D:\Projects\saad-portfolio\convex\schema.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Framer Motion for page animations</name>
  <files>package.json</files>
  <action>
Install Framer Motion library for declarative animations across all pages.

```bash
npm install framer-motion
```

Verify installation by checking package.json includes framer-motion dependency.

RESEARCH RATIONALE: Framer Motion is industry standard for React animations with excellent App Router support. Research confirms whileInView pattern for scroll reveals and GPU-only animation properties (transform/opacity) for performance.
  </action>
  <verify>
Run `npm list framer-motion` to confirm installation.
Check package.json contains framer-motion in dependencies section.
  </verify>
  <done>
Framer Motion installed and available for import in components.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Convex query functions for projects</name>
  <files>convex/projects.ts</files>
  <action>
Create query functions for projects data using index-optimized filtering from schema.

File: `convex/projects.ts` (new file)

```typescript
import { query } from "./_generated/server";
import { v } from "convex/values";

// List all published projects (for projects index page)
export const listPublished = query({
  handler: async (ctx) => {
    return await ctx.db
      .query("projects")
      .withIndex("by_status", (q) => q.eq("status", "published"))
      .order("desc")
      .collect();
  },
});

// Get top 3 featured published projects (for home page)
export const listFeatured = query({
  handler: async (ctx) => {
    return await ctx.db
      .query("projects")
      .withIndex("by_featured", (q) =>
        q.eq("featured", true).eq("status", "published")
      )
      .order("desc")
      .take(3);
  },
});

// Get single project by slug (for project detail pages)
export const getBySlug = query({
  args: { slug: v.string() },
  handler: async (ctx, { slug }) => {
    return await ctx.db
      .query("projects")
      .withIndex("by_slug", (q) => q.eq("slug", slug))
      .first();
  },
});
```

CRITICAL: Use `.withIndex()` for all queries. DO NOT use `.filter()` which scans entire table.

RESEARCH RATIONALE: Pattern from research shows compound index by_featured allows filtering both featured=true AND status=published efficiently. by_status index enables fast published-only filtering. by_slug index enables O(1) lookups for detail pages.
  </action>
  <verify>
Run `npx convex dev` (if not already running) to deploy query functions.
Check Convex dashboard shows projects.ts with 3 exported queries.
No TypeScript errors in convex/projects.ts.
  </verify>
  <done>
Convex queries for projects are deployed and callable from Next.js pages via api.projects.listPublished, api.projects.listFeatured, api.projects.getBySlug.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create Convex query function for resume</name>
  <files>convex/resume.ts</files>
  <action>
Create query function for resume data (single-document table).

File: `convex/resume.ts` (new file)

```typescript
import { query } from "./_generated/server";

// Get resume data (single document)
export const get = query({
  handler: async (ctx) => {
    // Resume table is single-document, get first entry
    return await ctx.db.query("resume").first();
  },
});
```

RESEARCH RATIONALE: Resume is single-document table (not many resumes, just one). Use simple .first() to retrieve. No index needed since there's only one document.
  </action>
  <verify>
Run `npx convex dev` (if not already running) to deploy query function.
Check Convex dashboard shows resume.ts with 1 exported query.
No TypeScript errors in convex/resume.ts.
  </verify>
  <done>
Convex query for resume is deployed and callable from Next.js pages via api.resume.get.
  </done>
</task>

</tasks>

<verification>
Run `npm list framer-motion` to confirm installation.
Check Convex dashboard at URL shown in terminal to see deployed query functions.
Verify convex/projects.ts exports 3 queries: listPublished, listFeatured, getBySlug.
Verify convex/resume.ts exports 1 query: get.
No TypeScript errors when running `npm run typecheck`.
</verification>

<success_criteria>
1. Framer Motion installed in package.json
2. convex/projects.ts exists with 3 query functions using indexes
3. convex/resume.ts exists with 1 query function
4. All queries deployed to Convex and visible in dashboard
5. No TypeScript compilation errors
6. Queries use withIndex() for efficient filtering (not .filter())
</success_criteria>

<output>
After completion, create `.planning/phases/02-public-content-pages/02-01-SUMMARY.md` documenting:
- Framer Motion version installed
- Query functions created and patterns used
- Index usage verification
- Any deviations or issues encountered
</output>
