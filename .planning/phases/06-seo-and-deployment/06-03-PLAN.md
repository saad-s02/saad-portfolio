---
phase: 06-seo-and-deployment
plan: 03
type: execute
wave: 3
depends_on: [06-02]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Pull requests generate preview deployments with unique URLs"
    - "Preview deployments have isolated Convex backend (not production)"
    - "Preview deployments can be tested without affecting production"
  artifacts: []
  key_links:
    - from: "Vercel preview deployment"
      to: "Convex preview backend"
      via: "CONVEX_DEPLOY_KEY preview environment variable"
      pattern: "Separate preview deploy key"

user_setup:
  - service: convex
    why: "Preview environment backend isolation"
    env_vars:
      - name: CONVEX_DEPLOY_KEY
        source: "Convex Dashboard -> Settings -> Deploy Keys -> Create Preview Deploy Key"
        environment: "Preview"
    steps:
      - task: "Generate preview deploy key"
        location: "Convex Dashboard -> Settings -> Deploy Keys"
        instructions: "Click 'Create Deploy Key', select 'Preview' environment, copy key"
  - service: workos
    why: "Preview deployment authentication (optional)"
    dashboard_config:
      - task: "Add wildcard CORS pattern for preview deployments"
        location: "WorkOS Dashboard -> CORS Settings"
        instructions: "Add pattern: *.vercel.app to allow preview deployments to authenticate"
      - task: "Note about preview auth limitations"
        instructions: "Preview deployments can authenticate, but each PR creates new URL. For production workflow, consider testing auth only in production. Preview deployments can test public pages without auth."
---

<objective>
Configure preview deployments for pull requests with isolated Convex backend environments and optional authentication support.

Purpose: Enable safe testing of changes in preview environments without affecting production data, establish PR preview workflow for development.

Output: PR preview deployments work with isolated backends, preview URL provided for each PR.
</objective>

<execution_context>
@D:\Projects\saad-portfolio\.claude\get-shit-done\workflows\execute-plan.md
@D:\Projects\saad-portfolio\.claude\get-shit-done\templates\summary.md
</execution_context>

<context>
@D:\Projects\saad-portfolio\.planning\PROJECT.md
@D:\Projects\saad-portfolio\.planning\ROADMAP.md
@D:\Projects\saad-portfolio\.planning\STATE.md
@D:\Projects\saad-portfolio\.planning\phases\06-seo-and-deployment\06-RESEARCH.md
@D:\Projects\saad-portfolio\.planning\phases\06-seo-and-deployment\06-02-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <action>Configure Convex preview deploy key and optional WorkOS CORS</action>
  <instructions>
**Required actions (cannot be automated - requires dashboard access):**

1. **Configure Convex Preview Deploy Key:**
   - Visit Convex Dashboard: https://dashboard.convex.dev
   - Navigate to your project -> Settings -> Deploy Keys
   - Click "Create Deploy Key"
   - Select "Preview" environment
   - Copy the generated deploy key
   - Go to Vercel Dashboard -> Project -> Settings -> Environment Variables
   - Add: `CONVEX_DEPLOY_KEY` = [paste preview key]
   - Environment: **Preview only** (important: do NOT set for Production)
   - This ensures preview deployments get isolated backend, not production

2. **Optional: Configure WorkOS for Preview Authentication:**

   **Option A - Enable Preview Auth (recommended for full testing):**
   - Visit WorkOS Dashboard -> CORS Settings
   - Add pattern: `*.vercel.app` to allow all Vercel preview URLs
   - This enables authentication in preview deployments
   - Note: Each PR gets unique URL, so wildcard pattern is needed

   **Option B - Skip Preview Auth (simpler, public pages only):**
   - Skip WorkOS configuration
   - Preview deployments will work for all public pages
   - Admin panel will not work in previews (acceptable for most PR reviews)
   - Production deployment has full auth working

   **Recommendation:** Start with Option B (skip preview auth). Most PRs review public pages. Enable Option A later if you need to test admin panel changes in previews.

**Verification checklist:**
- [ ] CONVEX_DEPLOY_KEY added to Vercel (Preview environment only)
- [ ] Preview deploy key is DIFFERENT from production key
- [ ] Optional: WorkOS CORS configured with *.vercel.app pattern
  </instructions>
  <resume-signal>Type "configured" when preview environment variables are set</resume-signal>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Preview deployment configuration with isolated Convex backend</what-built>
  <how-to-verify>
1. **Create test branch and PR:**
   - Create test branch: `git checkout -b test/preview-deployment`
   - Make a small change: Update a page title or add test content
   - Commit: `git commit -am "test: verify preview deployment"`
   - Push: `git push origin test/preview-deployment`
   - Open PR on GitHub

2. **Verify preview deployment created:**
   - Go to GitHub PR page
   - Check for Vercel bot comment with preview URL
   - Or visit Vercel Dashboard -> Deployments
   - Find deployment for your PR branch
   - Note the preview URL (https://project-name-git-branch-team.vercel.app)

3. **Test preview deployment:**
   - Visit the preview URL
   - Verify home page loads
   - Navigate to /about, /resume, /projects, /stack, /contact
   - Verify all public pages work correctly
   - Check browser console for errors

4. **Verify isolated backend:**
   - Visit Convex Dashboard
   - Check Deployments section
   - Verify new deployment exists named after your branch (e.g., "test-preview-deployment")
   - This confirms preview has separate backend, not using production data

5. **Optional: Test preview authentication (if Option A chosen):**
   - Visit preview URL /admin
   - Verify redirects to WorkOS login
   - Log in with allowlisted email
   - Verify admin panel loads (with empty data - separate backend)

6. **Test automatic preview updates:**
   - Make another small change locally
   - Commit and push to same branch
   - Verify Vercel automatically creates new preview deployment
   - Check that preview URL updates with changes

7. **Clean up:**
   - Close PR without merging (this is just a test)
   - Delete test branch
   - Verify Vercel automatically cleans up preview deployment after PR closed

**Expected results:**
- Preview deployment created for PR with unique URL
- All public pages work in preview
- Convex Dashboard shows separate branch-named deployment
- Preview updates automatically on new commits
- Preview cleaned up when PR closed
  </how-to-verify>
  <resume-signal>Type "approved" if preview deployments work correctly, or describe issues</resume-signal>
</task>

<task type="checkpoint:decision" gate="blocking">
  <decision>Custom domain configuration</decision>
  <context>
Phase 6 deployment is complete with Vercel-provided domain (https://project-name.vercel.app).

Custom domain setup is optional for v1. If you have a domain ready, we can configure it now. If not, the Vercel-provided domain works perfectly for production use.

**Custom domain benefits:**
- Professional branding (your-name.com vs project-name.vercel.app)
- Easier to share and remember
- Better for portfolio showcase

**Vercel-provided domain benefits:**
- Works immediately, no DNS configuration needed
- No domain purchase required
- Can add custom domain later without downtime
- Vercel HTTPS/SSL works identically for both

RESEARCH.md notes this as an open question - domain may not exist yet.
  </context>
  <options>
    <option id="skip-domain">
      <name>Skip custom domain (use Vercel URL)</name>
      <pros>
        - No additional configuration required
        - No domain purchase needed
        - Site is already live and working
        - Can add custom domain later (non-destructive change)
      </pros>
      <cons>
        - Less professional URL for portfolio
        - Vercel branding in URL
      </cons>
    </option>
    <option id="configure-domain">
      <name>Configure custom domain now</name>
      <pros>
        - Professional branded URL
        - Easier to share with recruiters/employers
        - Better portfolio presentation
      </pros>
      <cons>
        - Requires domain purchase if not owned
        - Requires DNS configuration (5-60 min propagation)
        - Additional task to complete
      </cons>
    </option>
  </options>
  <resume-signal>Select: skip-domain OR configure-domain

If configure-domain, provide domain name to configure</resume-signal>
</task>

</tasks>

<verification>
## Preview Deployment Checklist
- Pull request triggers automatic preview deployment
- Preview URL is unique per PR
- Public pages work in preview deployment
- Convex Dashboard shows branch-named deployment (isolated backend)
- Preview updates automatically on new commits to PR
- Preview cleaned up when PR closed/merged

## Optional: Preview Authentication
- If enabled: /admin redirects to WorkOS login in preview
- If disabled: /admin shows error in preview (acceptable)
- Production authentication unaffected

## Custom Domain (if configured)
- DNS records point to Vercel
- SSL certificate issued (5-60 min wait)
- Site accessible at custom domain
- Metadata URLs updated to custom domain
</verification>

<success_criteria>
- DEPLOY-05 covered: Preview deployments created for pull requests
- Preview deployments have isolated Convex backends (separate from production)
- Public pages work correctly in preview environments
- Automatic preview deployment on PR commits verified
- Optional: Custom domain configured if requested
- Phase 6 complete: All 11 requirements (SEO-01 through SEO-06, DEPLOY-01 through DEPLOY-05) satisfied
</success_criteria>

<output>
After completion, create `D:\Projects\saad-portfolio\.planning\phases\06-seo-and-deployment\06-03-SUMMARY.md`
</output>
